<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="stylesheet" href="/src/styles.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Voice Assistant</title>
    <script type="module" src="/src/main.ts" defer></script>
  </head>

  <body>
    <div class="titlebar"></div>

    <div class="app-layout">
      <!-- Main Content Area -->
      <main class="main-content">
        <header class="app-header">
          <h1>Voice Assistant</h1>
          <div class="header-actions">
            <button id="config-btn" class="config-btn" title="Configuration">‚öôÔ∏è</button>
            <div class="panel-toggles">
              <button id="toggle-transcript" class="panel-toggle active" title="Toggle Transcript Panel">
                <span>üìù</span> Transcript
              </button>
              <button id="toggle-ai" class="panel-toggle" title="Toggle AI Panel">
                <span>ü§ñ</span> AI Analysis
              </button>
            </div>
            <button id="btn-clear-session" class="panel-toggle clear-history" title="Clear transcript and AI history">
              <span>üßπ</span> Clear
            </button>
          </div>
        </header>

        <!-- Control Section -->
        <section class="controls-section">
          <div class="control-group primary-controls">
            <button id="btn-start" class="btn primary" type="button">Start Recording</button>
            <button id="btn-pause" class="btn" type="button" disabled>Pause</button>
            <button id="btn-resume" class="btn" type="button" disabled style="display: none;">Resume</button>
            <button id="btn-stop" class="btn" type="button" disabled>Stop Recording</button>
            <span id="status" class="status">Idle</span>
          </div>

          <div class="control-group settings-controls">
            <div class="settings-row">
              <label class="setting">
                <span>Format</span>
                <select id="format">
                  <option value="wav">WAV (lossless)</option>
                  <option value="mp3" selected>MP3 (compressed)</option>
                </select>
              </label>

              <label class="setting checkbox-setting">
                <input id="auto" type="checkbox" checked />
                <span>Auto Detect</span>
              </label>

              <label class="setting" id="quality-wrap">
                <span>Quality</span>
                <select id="quality">
                  <option value="high">High (320 kbps)</option>
                  <option value="medium">Medium (192 kbps)</option>
                  <option value="low">Low (128 kbps)</option>
                  <option value="verylow" selected>Very Low (64 kbps)</option>
                </select>
              </label>
            </div>

            <div class="settings-row">
              <label class="setting checkbox-setting">
                <input id="soniox-enable" type="checkbox" />
                <span>Live Transcript</span>
              </label>

              <span id="soniox-status" class="status-indicator soniox-status off">Off</span>
            </div>

            <div class="settings-row">

              <label class="setting">
                <span>Assistant</span>
                <select id="assistant-select">
                  <option value="">Loading...</option>
                </select>
              </label>

              <label class="setting">
                <span>Provider</span>
                <select id="ai-provider">
                  <option value="openai">OpenAI</option>
                  <option value="openrouter">OpenRouter</option>
                </select>
              </label>

              <label class="setting">
                <span>Model</span>
                <select id="ai-model">
                  <option value="">Enter API key to load models...</option>
                </select>
              </label>

              <label class="setting checkbox-setting">
                <input id="ai-enable" type="checkbox" />
                <span>AI Analysis</span>
              </label>

              <span id="ai-status" class="status-indicator ai-status ready">Ready</span>
              <span id="openrouter-credits" class="status-indicator openrouter-credits" style="display: none;"></span>
              <span id="gate-count" class="status-indicator gate-count">Gate: 0</span>
              <span id="model-count" class="status-indicator model-count">Model: 0</span>
              <span id="gate-last" class="status-indicator gate-last" title="">Decision: -</span>
            </div>
          </div>

          <!-- Audio Level Meter -->
          <div class="meter-section">
            <div class="meter-label">Input Level</div>
            <div class="meter-container">
              <div id="meter" class="meter">
                <div id="meter-fill" class="meter-fill"></div>
              </div>
            </div>
          </div>

          <p id="last-saved" class="last-saved"></p>
        </section>
      </main>

      <!-- Left Panel: Transcript -->
      <aside id="transcript-panel" class="side-panel left-panel">
        <div class="panel-header">
          <h3>Live Transcript</h3>
          <button class="panel-close" data-panel="transcript">√ó</button>
        </div>
        <div class="panel-content">
          <div id="transcript" class="transcript-content" aria-live="polite" aria-atomic="false">
            <div class="placeholder">Start recording to see live transcript...</div>
          </div>
        </div>
      </aside>

      <!-- Right Panel: AI Analysis -->
      <aside id="ai-panel" class="side-panel right-panel">
        <div class="panel-header">
          <h3>AI Analysis</h3>
          <div class="panel-tools">
            <button id="ai-prev" class="panel-toggle" title="Previous answer" disabled>‚Üê</button>
            <span id="ai-pos" class="status-indicator ai-pos">0/0</span>
            <button id="ai-next" class="panel-toggle" title="Next answer" disabled>‚Üí</button>
          </div>
          <button class="panel-close" data-panel="ai">√ó</button>
        </div>
        <div class="panel-content">
          <div id="ai-analysis" class="ai-analysis-content" aria-live="polite" aria-atomic="false">
            <div class="placeholder">Enable AI analysis to see insights and follow-up questions...</div>
          </div>
        </div>
      </aside>
    </div>

    <!-- Hidden inputs for backward compatibility with existing code -->
    <input id="soniox-api" type="hidden" />
    <input id="openai-api" type="hidden" />
    <input id="openrouter-api" type="hidden" />

    <!-- Configuration Modal -->
    <div id="config-modal" class="modal hidden">
      <div class="modal-content">
        <div class="modal-header">
          <h2>Configuration</h2>
          <button id="config-close" class="modal-close">√ó</button>
        </div>
        <div class="modal-body">
          <div class="config-section">
            <h3>Soniox (Speech Recognition)</h3>
            <div class="config-row">
              <label>API Key:</label>
              <input id="config-soniox-key" type="password" placeholder="sk_live_...">
            </div>
            <div class="config-row">
              <label>Audio Format:</label>
              <select id="config-soniox-format">
                <option value="pcm_s16le">PCM 16-bit LE</option>
              </select>
            </div>
            <div class="config-row">
              <label>
                <input id="config-soniox-enable" type="checkbox">
                Enable Live Transcript
              </label>
            </div>
          </div>

          <div class="config-section">
            <h3>AI Provider</h3>
            <div class="config-row">
              <label>Default Provider:</label>
              <select id="config-ai-provider">
                <option value="openai">OpenAI</option>
                <option value="openrouter">OpenRouter</option>
              </select>
            </div>
            <div class="config-row">
              <label>
                <input id="config-ai-enable" type="checkbox">
                Enable AI Analysis
              </label>
            </div>
          </div>

          <div class="config-section">
            <h3>OpenAI Settings</h3>
            <div class="config-row">
              <label>API Key:</label>
              <input id="config-openai-key" type="password" placeholder="sk-...">
            </div>
            <div class="config-row">
              <label>Model:</label>
              <select id="config-openai-model">
                <option value="">Enter API key to load models...</option>
              </select>
            </div>
            <div class="config-row">
              <label>Gate Model:</label>
              <select id="config-openai-gate-model">
                <option value="">Enter API key to load models...</option>
              </select>
            </div>
          </div>

          <div class="config-section">
            <h3>OpenRouter Settings</h3>
            <div class="config-row">
              <label>API Key:</label>
              <input id="config-openrouter-key" type="password" placeholder="or-...">
            </div>
            <div class="config-row">
              <label>Model:</label>
              <select id="config-openrouter-model">
                <option value="">Enter API key to load models...</option>
              </select>
            </div>
            <div class="config-row">
              <label>Gate Model:</label>
              <select id="config-openrouter-gate-model">
                <option value="">Enter API key to load models...</option>
              </select>
            </div>
            <div class="config-row">
              <label>Credits:</label>
              <span id="config-openrouter-credits">--</span>
            </div>
          </div>

          <div class="config-section">
            <h3>Recording Settings</h3>
            <div class="config-row">
              <label>Default Format:</label>
              <select id="config-recording-format">
                <option value="wav">WAV (lossless)</option>
                <option value="mp3">MP3 (compressed)</option>
              </select>
            </div>
            <div class="config-row">
              <label>Default Quality:</label>
              <select id="config-recording-quality">
                <option value="high">High (320 kbps)</option>
                <option value="medium">Medium (192 kbps)</option>
                <option value="low">Low (128 kbps)</option>
                <option value="verylow">Very Low (64 kbps)</option>
              </select>
            </div>
            <div class="config-row">
              <label>
                <input id="config-recording-auto" type="checkbox">
                Auto Detect Enabled by Default
              </label>
            </div>
          </div>

          <div class="config-section">
            <h3>Assistant Settings</h3>
            <div class="config-row">
              <label>Default Assistant:</label>
              <select id="config-default-assistant">
                <option value="general">General Assistant</option>
              </select>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button id="config-save" class="btn primary">Save Configuration</button>
          <button id="config-cancel" class="btn">Cancel</button>
        </div>
      </div>
    </div>
  </body>
</html>
